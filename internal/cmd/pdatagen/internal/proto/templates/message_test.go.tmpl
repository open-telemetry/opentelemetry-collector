// Copyright The OpenTelemetry Authors
// SPDX-License-Identifier: Apache-2.0

// Code generated by "internal/cmd/pdatagen/main.go". DO NOT EDIT.
// To regenerate this file run "make genpdata".

package internal

import (
	{{ range $index, $element := .testImports -}}
	{{ $element }}
	{{ end }}
)

func TestCopy{{ .messageName }}(t *testing.T) {
    for name, src := range genTestEncodingValues{{ .messageName }}() {
        for _, pooling := range []bool{true, false} {
            t.Run(name+"/Pooling="+strconv.FormatBool(pooling), func(t *testing.T) {
                prevPooling := UseProtoPooling.IsEnabled()
                require.NoError(t, featuregate.GlobalRegistry().Set(UseProtoPooling.ID(), pooling))
                defer func() {
                    require.NoError(t, featuregate.GlobalRegistry().Set(UseProtoPooling.ID(), prevPooling))
                }()

                dest := New{{ .messageName }}()
                Copy{{ .messageName }}(dest, src)
                assert.Equal(t, src, dest)
                Copy{{ .messageName }}(dest, dest)
                assert.Equal(t, src, dest)
            })
        }
    }
}

func TestCopy{{ .messageName }}Slice(t *testing.T) {
    src := []{{ .messageName }}{}
    dest := []{{ .messageName }}{}
    // Test CopyTo empty
    dest = Copy{{ .messageName }}Slice(dest, src)
    assert.Equal(t, []{{ .messageName }}{}, dest)

    // Test CopyTo larger slice
    src = GenTest{{ .messageName }}Slice()
    dest = Copy{{ .messageName }}Slice(dest, src)
    assert.Equal(t, GenTest{{ .messageName }}Slice(), dest)

    // Test CopyTo same size slice
    dest = Copy{{ .messageName }}Slice(dest, src)
    assert.Equal(t, GenTest{{ .messageName }}Slice(), dest)

    // Test CopyTo smaller size slice
    dest = Copy{{ .messageName }}Slice(dest, []{{ .messageName }}{})
    assert.Len(t, dest, 0)

    // Test CopyTo larger slice with enough capacity
    dest = Copy{{ .messageName }}Slice(dest, src)
    assert.Equal(t, GenTest{{ .messageName }}Slice(), dest)
}

func TestCopy{{ .messageName }}PtrSlice(t *testing.T) {
    src := []*{{ .messageName }}{}
    dest := []*{{ .messageName }}{}
    // Test CopyTo empty
    dest = Copy{{ .messageName }}PtrSlice(dest, src)
    assert.Equal(t, []*{{ .messageName }}{}, dest)

    // Test CopyTo larger slice
    src = GenTest{{ .messageName }}PtrSlice()
    dest = Copy{{ .messageName }}PtrSlice(dest, src)
    assert.Equal(t, GenTest{{ .messageName }}PtrSlice(), dest)

    // Test CopyTo same size slice
    dest = Copy{{ .messageName }}PtrSlice(dest, src)
    assert.Equal(t, GenTest{{ .messageName }}PtrSlice(), dest)

    // Test CopyTo smaller size slice
    dest = Copy{{ .messageName }}PtrSlice(dest, []*{{ .messageName }}{})
    assert.Len(t, dest, 0)

    // Test CopyTo larger slice with enough capacity
    dest = Copy{{ .messageName }}PtrSlice(dest, src)
    assert.Equal(t, GenTest{{ .messageName }}PtrSlice(), dest)
}

func TestMarshalAndUnmarshalJSON{{ .messageName }}Unknown(t *testing.T) {
	iter := json.BorrowIterator([]byte(`{"unknown": "string"}`))
	defer json.ReturnIterator(iter)
	dest := New{{ .messageName }}()
    dest.UnmarshalJSON(iter)
	require.NoError(t, iter.Error())
	assert.Equal(t, New{{ .messageName }}(), dest)
}

func TestMarshalAndUnmarshalJSON{{ .messageName }}(t *testing.T) {
	for name, src := range genTestEncodingValues{{ .messageName }}() {
        for _, pooling := range []bool{true, false} {
            t.Run(name+"/Pooling="+strconv.FormatBool(pooling), func(t *testing.T) {
                prevPooling := UseProtoPooling.IsEnabled()
                require.NoError(t, featuregate.GlobalRegistry().Set(UseProtoPooling.ID(), pooling))
                defer func() {
                    require.NoError(t, featuregate.GlobalRegistry().Set(UseProtoPooling.ID(), prevPooling))
                }()

                stream := json.BorrowStream(nil)
                defer json.ReturnStream(stream)
                src.MarshalJSON(stream)
                require.NoError(t, stream.Error())

                iter := json.BorrowIterator(stream.Buffer())
                defer json.ReturnIterator(iter)
                dest := New{{ .messageName }}()
                dest.UnmarshalJSON(iter)
                require.NoError(t, iter.Error())

                assert.Equal(t, src, dest)
                Delete{{ .messageName }}(dest, true)
            })
        }
	}
}

func TestMarshalAndUnmarshalProto{{ .messageName }}Failing(t *testing.T) {
    for name, buf := range genTestFailingUnmarshalProtoValues{{ .messageName }}() {
        t.Run(name, func(t *testing.T) {
            dest := New{{ .messageName }}()
            require.Error(t, dest.UnmarshalProto(buf))
        })
    }
}

func TestMarshalAndUnmarshalProto{{ .messageName }}Unknown(t *testing.T) {
	dest := New{{ .messageName }}()
	// message Test { required int64 field = 1313; } encoding { "field": "1234" }
	require.NoError(t, dest.UnmarshalProto([]byte{0x88, 0x52, 0xD2, 0x09}))
	assert.Equal(t, New{{ .messageName }}(), dest)
}

func TestMarshalAndUnmarshalProto{{ .messageName }}(t *testing.T) {
	for name, src := range genTestEncodingValues{{ .messageName }}(){
        for _, pooling := range []bool{true, false} {
            t.Run(name+"/Pooling="+strconv.FormatBool(pooling), func(t *testing.T) {
                prevPooling := UseProtoPooling.IsEnabled()
                require.NoError(t, featuregate.GlobalRegistry().Set(UseProtoPooling.ID(), pooling))
                defer func() {
                    require.NoError(t, featuregate.GlobalRegistry().Set(UseProtoPooling.ID(), prevPooling))
                }()

                buf := make([]byte, src.SizeProto())
                gotSize := src.MarshalProto(buf)
                assert.Equal(t, len(buf), gotSize)

                dest := New{{ .messageName }}()
                require.NoError(t, dest.UnmarshalProto(buf))

                assert.Equal(t, src, dest)
                Delete{{ .messageName }}(dest, true)
            })
        }
	}
}

func TestMarshalAndUnmarshalProtoViaProtobuf{{ .messageName }}(t *testing.T) {
	for name, src := range genTestEncodingValues{{ .messageName }}(){
		t.Run(name, func(t *testing.T) {
            buf := make([]byte, src.SizeProto())
            gotSize := src.MarshalProto(buf)
            assert.Equal(t, len(buf), gotSize)

            goDest := &{{ .upstreamMessage }}{}
            require.NoError(t, proto.Unmarshal(buf, goDest))

            goBuf, err := proto.Marshal(goDest)
            require.NoError(t, err)

            dest := New{{ .messageName }}()
            require.NoError(t, dest.UnmarshalProto(goBuf))
            assert.Equal(t, src, dest)
        })
	}
}

func genTestFailingUnmarshalProtoValues{{ .messageName }}() map[string][]byte {
    return map[string][]byte{
		"invalid_field": { 0x02 },
        {{- range .fields }}{{ .GenTestFailingUnmarshalProtoValues }}{{- end }}
    }
}

func genTestEncodingValues{{ .messageName }}() map[string]*{{ .messageName }} {
	return map[string]*{{ .messageName }}{
		"empty": New{{ .messageName }}(),
		{{- range .fields }}{{ .GenTestEncodingValues }}{{- end }}
	}
}
