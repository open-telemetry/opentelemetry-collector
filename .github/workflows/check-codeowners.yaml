# Copyright The OpenTelemetry Authors
# SPDX-License-Identifier: Apache-2.0

# This workflow is used to check that the CODEOWNERS file is valid.
#
# The workflow is triggered on pull requests that are opened, synchronized,
# reopened, or ready for review. It runs on the `pull_request` event
# to safely validate code from external contributors without exposing secrets.
#
# The workflow uses the `mszostok/codeowners-validator` action to check the
# CODEOWNERS file. The action is configured to check for changes since the
# base branch of the PR.
#
# See https://github.com/mszostok/codeowners-validator for more information.

name: Check CODEOWNERS
on:
  pull_request:
    types:
      - opened
      - synchronize
      - reopened
      - ready_for_review

permissions:
  contents: read

jobs:
  check-codeowners:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          # Fetch all history so we can compare with the base branch.
          fetch-depth: 0

      - name: Check for CODEOWNERS changes
        uses: mszostok/codeowners-validator@v0.8.0
        with:
          # We need to check against the base branch for changes.
          # See https://github.com/mszostok/codeowners-validator#validating-codeowners-in-a-pull-request.
          changes_since: ${{ github.event.pull_request.base.ref }}
          # The GITHUB_TOKEN is passed to the validator.
          # With a pull_request trigger, this token is read-only and cannot be used
          # to comment on the PR.
          repo_token: ${{ secrets.GITHUB_TOKEN }}
